type: masonry
path: smartmeter
title: Smartmeter
icon: mdi:lightning-bolt
cards:
  - type: custom:mushroom-chips-card
    chips:
      - type: back
  - type: custom:modern-circular-gauge
    entity: sensor.currently_energy_delivered_watt
    secondary: {}
    tertiary: {}
    min: 0
    needle: true
    start_from_zero: false
    show_state: true
    show_unit: true
    adaptive_state_color: false
    header_position: top
    smooth_segments: true
    show_header: true
    show_icon: false
    adaptive_icon_color: true
    segments:
      - from: 0
        color:
          - 143
          - 255
          - 50
      - from: 800
        color:
          - 255
          - 228
          - 50
      - from: 1500
        color:
          - 196
          - 0
          - 0
    max: 2000
    name: Current Usage
    gauge_foreground_style:
      opacity: 1
      width: 8
    gauge_background_style:
      opacity: 1
      width: 4
  - type: custom:apexcharts-card
    experimental:
      color_threshold: true
    graph_span: 1h
    show:
      last_updated: true
    apex_config:
      yaxis:
        - id: first
          forceNiceScale: true
          decimalsInFloat: 3
      fill:
        type: solid
        opacity: 0.25
    header:
      standard_format: false
      show: true
      show_states: true
      colorize_states: true
      title: Past hour - median per minute
    series:
      - entity: sensor.currently_energy_delivered_watt
        name: Usage
        type: area
        group_by:
          func: median
          duration: 1m
        stroke_width: 4
      - entity: sensor.currently_energy_returned_watt
        name: Return
        type: line
        group_by:
          func: median
          duration: 1m
        stroke_width: 4
  - type: custom:apexcharts-card
    graph_span: 24h
    span:
      start: day
    header:
      show: true
      title: Usage last 24 hours
    apex_config:
      yaxis:
        - id: first
          forceNiceScale: true
          decimalsInFloat: 2
          opposite: false
          name: Energie
    series:
      - entity: sensor.energy_usage_peak_hourly
        unit: kWh
        type: column
        name: High tariff usage
        color: "#EF810E"
        group_by:
          func: max
        show:
          datalabels: false
          extremas: false
      - entity: sensor.energy_usage_offpeak_hourly
        unit: kWh
        type: column
        name: Low tariff usage
        color: "#053752"
        group_by:
          func: max
        show:
          datalabels: false
          extremas: false
  - type: energy-distribution
    link_dashboard: true
  - type: vertical-stack
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_mac_address
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_ip_address
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_startup_time
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_wifi_signal_strength_rssi
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_firmware_running_version
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_firmware_available_version
      - type: custom:mushroom-entity-card
        entity: sensor.smartmeter_firmware_update_available
      - type: custom:mushroom-entity-card
        entity: switch.smartmeter_install_firmware_update
      - type: custom:mushroom-entity-card
        entity: binary_sensor.smartmeter_connectivity_status